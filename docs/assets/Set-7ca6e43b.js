import{g as N,u as q,r as C,a as v,o as I,V as _,c as d,d as f,x as y,w as s,h as t,e as U,i as M,N as O,j as c,v as i,f as p,k as j,O as A,P as b,Q as R}from"./index-29034bfe.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const E=["src"],F={__name:"Set",setup(J){const{proxy:r}=N(),m=q(),e=C({}),g=v({});I(()=>{Object.assign(e,JSON.parse(_.get("userInfo")))});const x=async(o,a)=>{if(o.code==200){let u=await A({id:e.id,img:o.data});u.code==200?(r.message.success(u.msg),e.avatar=o.data,_.set("userInfo",JSON.stringify(e),"7d"),m.push("/refresh")):r.message.error(u.msg)}else r.message.error("上传失败!")},k=o=>o.type!=="image/jpeg"?(b.error("上传文件必须是图片!"),!1):o.size/1024/1024>2?(b.error("头像大小不能超过2MB!"),!1):!0,w=v({username:{required:!0,message:"请输入巡查人员姓名"},avatar:{required:!0,message:"请选择图片"},account:{required:!0,message:"请输入账号"},email:{required:!0,message:"请输入邮箱"}}),h=()=>{g.value.validate(async o=>{if(!o)return;const a=await R(e);a.code==200?(r.message.success(a.msg),e.password!=""?r.confirm("账号更新成功，请重新登录!",()=>{_.delete("token"),m.push("/login")}):m.push("/")):r.message.success(a.msg)})};return(o,a)=>{const u=d("el-icon"),V=d("el-upload"),n=d("el-form-item"),S=d("el-button"),B=d("el-form");return f(),y(B,{model:e,rules:w.value,"label-width":"100px",ref_key:"adminRef",ref:g},{default:s(()=>[t(n,{prop:"avatar",label:"头像: "},{default:s(()=>[t(V,{class:"avatar-uploader",action:"http://127.0.0.1:5173/api/equipment/err","show-file-list":!1,"on-success":x,"before-upload":k},{default:s(()=>[e.avatar?(f(),U("img",{key:0,src:e.avatar,class:"avatar"},null,8,E)):(f(),y(u,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[t(M(O))]),_:1}))]),_:1})]),_:1}),t(n,{prop:"username",label:"用户名"},{default:s(()=>[c(p("input",{placeholder:"输入新的名字","onUpdate:modelValue":a[0]||(a[0]=l=>e.username=l)},null,512),[[i,e.username]])]),_:1}),t(n,{prop:"account",label:"账号"},{default:s(()=>[c(p("input",{placeholder:"请输入账号","onUpdate:modelValue":a[1]||(a[1]=l=>e.account=l)},null,512),[[i,e.account]])]),_:1}),t(n,{prop:"email",label:"邮箱"},{default:s(()=>[c(p("input",{placeholder:"请输入邮箱","onUpdate:modelValue":a[2]||(a[2]=l=>e.email=l)},null,512),[[i,e.email]])]),_:1}),t(n,{label:"密码"},{default:s(()=>[c(p("input",{placeholder:"请输入密码",type:"password","onUpdate:modelValue":a[3]||(a[3]=l=>e.password=l)},null,512),[[i,e.password]])]),_:1}),t(n,null,{default:s(()=>[t(S,{size:"large",type:"primary",onClick:h},{default:s(()=>[j("更新")]),_:1})]),_:1})]),_:1},8,["model","rules"])}}},P=z(F,[["__scopeId","data-v-d0284be7"]]);export{P as default};
