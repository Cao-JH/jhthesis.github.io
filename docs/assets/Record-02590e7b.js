import{g as M,a as c,r as V,c as n,d as u,e as b,f as p,h as o,w as a,A as P,F as w,k as q,s as C,C as G,x as R,p as K,l as Q}from"./index-e734480e.js";import{r as W,a as X,u as Y,d as Z}from"./record-4fdbfe21.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";const le=m=>(K("data-v-b0fa3c14"),m=m(),Q(),m),oe={class:"top-panel"},te=le(()=>p("span",null,"巡查人员: ",-1)),ae={class:"op"},se=["onClick"],ne=["onClick"],de={__name:"Record",setup(m){const{proxy:i}=M(),_=c([]),S=c([]),L=[{label:"ID",prop:"id",width:50},{label:"路线",prop:"route_name",width:150},{label:"巡查人",prop:"inspector_name",width:100},{label:"备注",prop:"check_remark"},{label:"创建时间",prop:"created_at",width:200},{label:"操作",prop:"op",width:150,scopedSlots:"op"}],f=c({}),D=V({list:[]}),N={extHeight:50},t=c({}),I=c(),O=(s,e)=>{d.show=!0,G(()=>{I.value.resetFields(),console.log(s),s=="add"?(d.title="新增任务",t.value={type:"add"}):s=="update"&&(d.title="编辑任务信息",console.log(e),t.value=JSON.parse(JSON.stringify(e)),Object.assign(t.value,{type:"update"}))})},d=V({show:!1,title:"标题",buttons:[{type:"danger",text:"确定",click:s=>{B()}}]}),$=c({}),h=V({page:1,pageSize:10,pageCount:0,count:0,keyword:"",gender:""}),v=async()=>{Object.assign(h,f.value),console.log(h);let s=await W(h);s.code==200&&(Object.assign(D,s.data),_.value=s.data.inspector,S.value=s.data.routes,_.value.unshift({id:"",name:"全部"}))},B=async()=>{if(console.log(t),t.value.rid==null||t.value.uid==null)i.message.error("添加或修改数据有误，请重新选择!");else{let{type:s}=t.value,e={};Object.assign(e,t.value);let r="";s=="add"?r=await X(e):r=await Y(e),console.log(r),r.code==200?(d.show=!1,i.message.success(r.msg),v()):i.message.error(r.msg)}},T=s=>{i.confirm("你确定要删除该记录吗?",async()=>{const e=await Z({id:s.id});e.code==200?(i.message.success(e.msg),v()):i.message.error(e.msg)})};return(s,e)=>{const r=n("el-button"),g=n("el-form-item"),j=n("el-col"),k=n("el-option"),y=n("el-select"),U=n("el-row"),F=n("el-form"),z=n("el-divider"),A=n("Table"),J=n("el-input"),E=n("Dialog");return u(),b(w,null,[p("div",oe,[o(F,{onSubmit:e[3]||(e[3]=P(()=>{},["prevent"])),model:f.value,class:"search-form",labelAlign:"left"},{default:a(()=>[o(U,{gutter:5},{default:a(()=>[o(j,{span:2},{default:a(()=>[o(g,null,{default:a(()=>[o(r,{type:"primary",onClick:e[0]||(e[0]=l=>O("add"))},{default:a(()=>[q("创建任务")]),_:1})]),_:1})]),_:1}),o(j,{span:4},{default:a(()=>[te,o(y,{modelValue:f.value.id,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value.id=l),class:"m-2",placeholder:"巡查人员"},{default:a(()=>[(u(!0),b(w,null,C(_.value,l=>(u(),R(k,{key:l.id,label:l.name,onClick:e[1]||(e[1]=x=>v()),value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model"])]),o(A,{columns:L,showPagination:!0,dataSource:D,fetch:v,options:N},{op:a(({index:l,row:x})=>[p("div",ae,[p("a",{href:"javascript:void(0)",class:"a-link",onClick:H=>O("update",x)},"修改",8,se),o(z,{direction:"vertical"}),p("a",{href:"javascript:void(0)",class:"a-link",onClick:H=>T(x)},"删除",8,ne)])]),_:1},8,["dataSource"]),o(E,{title:d.title,show:d.show,buttons:d.buttons,onClose:e[7]||(e[7]=l=>d.show=!1),width:"400px"},{default:a(()=>[o(F,{model:t.value,rules:$.value,ref_key:"formDataRef",ref:I,"label-width":"80px"},{default:a(()=>[o(g,{prop:"name",label:"路线"},{default:a(()=>[o(y,{modelValue:t.value.rid,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.rid=l),placeholder:"请选择巡查路线"},{default:a(()=>[(u(!0),b(w,null,C(S.value,l=>(u(),R(k,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(g,{prop:"inspector",label:"巡查人员"},{default:a(()=>[o(y,{modelValue:t.value.uid,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.uid=l),placeholder:"请选择巡查人员"},{default:a(()=>[(u(!0),b(w,null,C(_.value,l=>(u(),R(k,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(g,{prop:"tip",label:"备注"},{default:a(()=>[o(J,{placeholder:"请输入备注",type:"textarea",autosize:{minRows:2,maxRows:4},modelValue:t.value.check_remark,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.check_remark=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","show","buttons"])],64)}}},ce=ee(de,[["__scopeId","data-v-b0fa3c14"]]);export{ce as default};
